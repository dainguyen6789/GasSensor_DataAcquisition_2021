C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      08/03/2018 17:26:10 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE BIPOLARMOTOR
OBJECT MODULE PLACED IN .\Obj\BipolarMotor.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE BipolarMotor.c LARGE BROWSE INCDIR(.\Application\Header) DEBUG OBJECTEXT
                    -END PRINT(.\Lis\BipolarMotor.lst) TABS(2) OBJECT(.\Obj\BipolarMotor.obj)

line level    source

   1          #include "stc15f2k60s2.h"
   2          #include "LCD_Driver_SPLC780D.h"
   3          #include "Receiver_Position_Data.h"
   4          #include "math.h"
   5          //#include "PCF85963BTL.h"
   6          void Delay_ms(unsigned int ms);
   7          int Day_Of_Year(unsigned char months,unsigned char days);
   8          unsigned char BCDtoDec1(char bcd);
   9          float trend_line_30_31(float time);
  10          float degree;
  11          
  12          unsigned char BCDtoDec1(unsigned char bcd)
  13          {
  14   1        unsigned char hi,lo;
  15   1        hi=bcd>>4;
  16   1        lo=bcd&0x0F;
  17   1        return hi*10+lo;
  18   1      }
  19          
  20          
  21          
  22          
  23          
  24          void Step_move(unsigned int step, bit dir)
  25          {
  26   1            unsigned int i=0;
  27   1            if(dir)
  28   1              P4 |=(1<<2);// set bit P4.2
  29   1            else
  30   1              P4 &=~(1<<2);// clear bit P4.2
  31   1            
  32   1            for( i=0;i<step;i++)
  33   1            {
  34   2                P4 |=1<<1;// P41=1 // moving distance (mm)=pi^2*step*4/675
  35   2                Wait_ms(2);
  36   2                P4 &= ~(1<<1);
  37   2                Wait_ms(2);
  38   2            }
  39   1      }
  40          
  41          void Move(float distance, bit direction)
  42          {
  43   1          unsigned int step;
  44   1          step= (unsigned int)(distance*337.5/(3.14159));
  45   1          Step_move(step,direction);
  46   1      }
  47          
  48          
  49          
  50          
  51          void Update_position(unsigned char mnths,unsigned char dys,unsigned char hurs,unsigned char mns,unsigned c
             -har sconds,float *currnt_pos)
  52          {
  53   1        unsigned int date,i;
C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      08/03/2018 17:26:10 PAGE 2   

  54   1        float desired_distance,distance=0;
  55   1        /*hurs=0x12;
  56   1        mns=0x30;*/
  57   1        //sconds=0x15;
  58   1        desired_distance=*currnt_pos;
  59   1        date=Day_Of_Year(mnths,dys);
  60   1        //date=80;
  61   1        for(i=0;i<num_of_time_stamp;i++)// 13 diff values of time stamp
  62   1        {
  63   2          if ((i+1)<num_of_time_stamp && ((BCDtoDec1(hurs)*60+BCDtoDec1(mns))<=(Time_stamp_PM[i+1][0]*60+Time_stam
             -p_PM[i+1][1])) && ((BCDtoDec1(hurs)*60+BCDtoDec1(mns))>=(Time_stamp_PM[i][0]*60+Time_stamp_PM[i][1])) && BCDtoDec1(mns)%
             -2==0)// update every 2 mins
  64   2          {
  65   3            switch(date)
  66   3            {
  67   4              case 216://04Aout2018
  68   4                desired_distance=trend_line_30_31(hurs+(float)mns/60+(float)sconds/3600);
  69   4            }
  70   3            distance=desired_distance-*currnt_pos;
  71   3            *currnt_pos=desired_distance;// change to sync with step movement
  72   3            if(distance>0)
  73   3            {
  74   4              Move(distance,1);// counter clock wise
  75   4            }
  76   3            else if(distance<0)
  77   3            {
  78   4              Move(-distance,0);// clock wise
  79   4            }
  80   3            else
  81   3            {
  82   4            } 
  83   3            
  84   3            break;
  85   3            
  86   3          }
  87   2          
  88   2        }
  89   1      }
  90          
  91          float trend_line_30_31(float time)
  92          {
  93   1        return -4.88*time*time+126.08*time-745.26-(1.1*4.5);
  94   1      
  95   1      }
  96          //
  97          /*
  98            for(i=0;i<13;i++)
  99            {
 100              if (BCDtoDec1(hurs)<=Time_stamp_PM[i+1][0] && BCDtoDec1(hurs)>=Time_stamp_PM[i][0] && BCDtoDec1(mns)>= T
             -ime_stamp_PM[i][1] && BCDtoDec1(mns)<= Time_stamp_PM[i+1][1] && BCDtoDec1(mns)%5==0)
 101              {
 102                desired_distance=(receiver_pos[i+1][0]-receiver_pos[i][0])/(Time_stamp_PM[i+1][0]*60+Time_stamp_PM[i+1]
             -[1]-Time_stamp_PM[i][0]*60-Time_stamp_PM[i][1])*(BCDtoDec1(hurs)*60+BCDtoDec1(mns)-Time_stamp_PM[i][0]*60-Time_stamp_PM[
             -i][1])+receiver_pos[i][0];
 103              }
 104            }
 105          */
 106          
 107          //int Day_Of_Year(unsigned char months,unsigned char days)*/


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      08/03/2018 17:26:10 PAGE 3   

   CODE SIZE        =    863    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    124      32
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
