C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      07/29/2018 09:32:49 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE BIPOLARMOTOR
OBJECT MODULE PLACED IN .\Obj\BipolarMotor.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE BipolarMotor.c LARGE BROWSE INCDIR(.\Application\Header) DEBUG OBJECTEXTEND
                    - PRINT(.\Lis\BipolarMotor.lst) TABS(2) OBJECT(.\Obj\BipolarMotor.obj)

line level    source

   1          #include "stc15f2k60s2.h"
   2          #include "LCD_Driver_SPLC780D.h"
   3          #include "Receiver_Position_Data.h"
   4          #include "math.h"
   5          //#include "PCF85963BTL.h"
   6          void Delay_ms(unsigned int ms);
   7          int Day_Of_Year(unsigned char months,unsigned char days);
   8          unsigned char BCDtoDec1(char bcd);
   9          float degree;
  10          
  11          unsigned char BCDtoDec1(unsigned char bcd)
  12          {
  13   1        unsigned char hi,lo;
  14   1        hi=bcd>>4;
  15   1        lo=bcd&0x0F;
  16   1        return hi*10+lo;
  17   1      }
  18          
  19          
  20          
  21          
  22          
  23          void Step_move(unsigned int step, bit dir)
  24          {
  25   1            unsigned int i=0;
  26   1            if(dir)
  27   1              P4 |=(1<<2);// set bit P4.2
  28   1            else
  29   1              P4 &=~(1<<2);// clear bit P4.2
  30   1            
  31   1            for( i=0;i<step;i++)
  32   1            {
  33   2                P4 |=1<<1;// P41=1 // moving distance (mm)=pi^2*step*4/675
  34   2                Wait_ms(2);
  35   2                P4 &= ~(1<<1);
  36   2                Wait_ms(2);
  37   2            }
  38   1      }
  39          
  40          void Move(float distance, bit direction)
  41          {
  42   1          unsigned int step;
  43   1          step= (unsigned int)(distance*337.5/(3.14159));
  44   1          Step_move(step,direction);
  45   1      }
  46          
  47          
  48          
  49          
  50          void Update_position(unsigned char mnths,unsigned char dys,unsigned char hurs,unsigned char mns,unsigned c
             -har sconds,float *currnt_pos)
  51          {
  52   1        unsigned int date,i;
  53   1        float desired_distance,distance=0;
C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      07/29/2018 09:32:49 PAGE 2   

  54   1        /*hurs=0x12;
  55   1        mns=0x30;*/
  56   1        //sconds=0x15;
  57   1        desired_distance=*currnt_pos;
  58   1        date=Day_Of_Year(mnths,dys);
  59   1        //date=80;
  60   1        for(i=0;i<19;i++)// 13 diff values of time stamp
  61   1        {
  62   2          if (BCDtoDec1(hurs)==Time_stamp_PM[i][0] && BCDtoDec1(mns)== Time_stamp_PM[i][1] && BCDtoDec1(sconds&0x7
             -f)==Time_stamp_PM[i][2])// check if current time match the time stamp in the table
  63   2          {     
  64   3            switch(date)
  65   3            {
  66   4              case 210://29July2018
  67   4                desired_distance=receiver_pos[i][0];//18July2018 is stored in the 1st column
  68   4                break;
  69   4              case 80:
  70   4                desired_distance=receiver_pos[i][1];
  71   4                break;
  72   4              case 81:
  73   4                desired_distance=receiver_pos[i][2];
  74   4                break;
  75   4              case 82:
  76   4                desired_distance=receiver_pos[i][3];
  77   4                break;
  78   4              case 83:
  79   4                desired_distance=receiver_pos[i][4];
  80   4                break;
  81   4              default:
  82   4                break;
  83   4            }
  84   3            
  85   3            //desired_distance=receiver_pos[0][4];;
  86   3            //distance=11;
  87   3            distance=desired_distance-*currnt_pos;
  88   3            *currnt_pos=desired_distance;// change to sync with step movement
  89   3            if(distance>0)
  90   3            {
  91   4              Move(distance,1);// counter clock wise
  92   4            }
  93   3            else if(distance<0)
  94   3            {
  95   4              Move(-distance,0);// clock wise
  96   4            }
  97   3            else
  98   3            {
  99   4            } 
 100   3            
 101   3            break;
 102   3          }
 103   2          if ((i+1)<19 && ((BCDtoDec1(hurs)*60+BCDtoDec1(mns))<=(Time_stamp_PM[i+1][0]*60+Time_stamp_PM[i+1][1])) 
             -&& ((BCDtoDec1(hurs)*60+BCDtoDec1(mns))>=(Time_stamp_PM[i][0]*60+Time_stamp_PM[i][1])) && BCDtoDec1(mns)%2==0)// update 
             -every 2 mins
 104   2          {
 105   3            switch(date)
 106   3            {
 107   4              case 210://29July2018
 108   4                desired_distance=(receiver_pos[i+1][0]-receiver_pos[i][0])/(Time_stamp_PM[i+1][0]*60+Time_stamp_PM[i+
             -1][1]
 109   4                                  -Time_stamp_PM[i][0]*60-Time_stamp_PM[i][1])
 110   4                                  *(BCDtoDec1(hurs)*60+BCDtoDec1(mns)-Time_stamp_PM[i][0]*60-Time_stamp_PM[i][1])
 111   4                                  +receiver_pos[i][0];// desired_pos=(pos_end-pos_start)/(time_end-time_start)*(current_time- 
C51 COMPILER V9.52.0.0   BIPOLARMOTOR                                                      07/29/2018 09:32:49 PAGE 3   

             -time_start)+pos_start
 112   4            }
 113   3            distance=desired_distance-*currnt_pos;
 114   3            *currnt_pos=desired_distance;// change to sync with step movement
 115   3            if(distance>0)
 116   3            {
 117   4              Move(distance,1);// counter clock wise
 118   4            }
 119   3            else if(distance<0)
 120   3            {
 121   4              Move(-distance,0);// clock wise
 122   4            }
 123   3            else
 124   3            {
 125   4            } 
 126   3            
 127   3            break;
 128   3            
 129   3          }
 130   2          
 131   2        }
 132   1      }
 133          //
 134          /*
 135            for(i=0;i<13;i++)
 136            {
 137              if (BCDtoDec1(hurs)<=Time_stamp_PM[i+1][0] && BCDtoDec1(hurs)>=Time_stamp_PM[i][0] && BCDtoDec1(mns)>= T
             -ime_stamp_PM[i][1] && BCDtoDec1(mns)<= Time_stamp_PM[i+1][1] && BCDtoDec1(mns)%5==0)
 138              {
 139                desired_distance=(receiver_pos[i+1][0]-receiver_pos[i][0])/(Time_stamp_PM[i+1][0]*60+Time_stamp_PM[i+1]
             -[1]-Time_stamp_PM[i][0]*60-Time_stamp_PM[i][1])*(BCDtoDec1(hurs)*60+BCDtoDec1(mns)-Time_stamp_PM[i][0]*60-Time_stamp_PM[
             -i][1])+receiver_pos[i][0];
 140              }
 141            }
 142          */
 143          
 144          //int Day_Of_Year(unsigned char months,unsigned char days)*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1493    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    137      28
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
