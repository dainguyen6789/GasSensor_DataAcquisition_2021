C51 COMPILER V9.52.0.0   UART1                                                             05/28/2019 15:04:08 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE UART1
OBJECT MODULE PLACED IN .\Obj\UART1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Application\Source\UART1.c LARGE BROWSE INCDIR(.\Application\Header) DEB
                    -UG OBJECTEXTEND PRINT(.\Lis\UART1.lst) TABS(2) OBJECT(.\Obj\UART1.obj)

line level    source

   1          #include "stc15f2k60s2.h"
   2          #include "PCF85063BTL.h"
   3          #include <stdlib.h>
   4          #include "UART1.h"
   5          #include <string.h>
   6          #define TBAUD (65536-FOSC/4/BAUD)
   7          #define FOSC 18432000L
   8          #define BAUD 115200
   9          
  10          
  11          
  12          
  13          unsigned char SPI_ReadTime(unsigned char addr);
  14          void SPI_WriteTime(unsigned char val,unsigned char addr);
  15          unsigned char ASCIItoBCD(unsigned char ascii[2]); // time format hh:mm:ss
  16          void SendUART1(unsigned char dat);
  17          
  18          void uart1_InitTCPConn();
  19          
  20          void uart1_SendToTCPServer(char *str);
  21          void Delay_ms(unsigned int ms);
  22          
  23          
  24          void initUART1(void)
  25          {
  26   1        SCON=0x50; //0101 0000 8-bit uart,  baud rate variable
  27   1        AUXR |=0x95;//10010101 Timer2 as Baud Rate generator
  28   1        T2L=TBAUD;
  29   1        T2H=TBAUD>>8; 
  30   1        ES=1;           // enable uart1 interrupt
  31   1        EA=1;           // each interrupt source will be enable or disable by setting its interrupt bit
  32   1        //PS=0;           // Serial Port 1 interrupt priority control bit, DS page 561
  33   1      }
  34          
  35          void SendUART1(unsigned char dat)
  36          {
  37   1        while(busy);
  38   1        busy=1;
  39   1        ACC=dat;
  40   1        SBUF=ACC;
  41   1      }
  42          
  43          
  44           void SendString(char *s)
  45          {
  46   1        while(*s)
  47   1        {
  48   2          SendUART1(*s++);
  49   2        }
  50   1      }
  51          
  52          unsigned char ten(unsigned char BCD)
  53          {
  54   1        return (BCD)>>4;
C51 COMPILER V9.52.0.0   UART1                                                             05/28/2019 15:04:08 PAGE 2   

  55   1      }
  56          unsigned char unit(unsigned char BCD)
  57          {
  58   1      
  59   1        //unit=BCD&0x0f;
  60   1        //dec=ten*10+unit;
  61   1        return BCD&0x0f;
  62   1      }
  63          unsigned char DectoBCD(unsigned char dec)
  64          {
  65   1        
  66   1        return dec;
  67   1      }
  68          //if dat=1, we need to use ASCII value to display "1" on UART1
  69          unsigned char ASCII_Letter(unsigned char dat)
  70          {
  71   1        
  72   1        return dat+48;
  73   1      }
  74          
  75          unsigned char ASCIItoBCD(unsigned char ascii[2]) // time format hh:mm:ss
  76          {
  77   1        unsigned char dec_val,ten, unit;
  78   1        dec_val=atoi(ascii);
  79   1        ten=dec_val/10;
  80   1        unit=dec_val%10;
  81   1        return ten<<4|unit;
  82   1        
  83   1      }
  84          
  85          void uart1_InitTCPConn()
  86          {
  87   1        //SendString("AT\r\n");
  88   1        //while(RI==0);
  89   1        //RI=0;
  90   1        SendString("AT+CIPSTART=\"TCP\",\"192.168.11.203\",8080\r\n");
  91   1        
  92   1      }
  93          
  94          void uart1_SendToTCPServer(char *str)
  95          {
  96   1        SendString("AT+CIPSEND=3\r\n");
  97   1        Delay_ms(1000);
  98   1        SendString("123");
  99   1        SendString("\r\n");
 100   1        Delay_ms(1000);
 101   1      
 102   1      }
*** WARNING C280 IN LINE 94 OF Application\Source\UART1.c: 'str': unreferenced local variable
 103          
 104          
 105           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    178    ----
   CONSTANT SIZE    =     64    ----
   XDATA SIZE       =   ----       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.52.0.0   UART1                                                             05/28/2019 15:04:08 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
