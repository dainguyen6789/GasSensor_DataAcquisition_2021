C51 COMPILER V9.52.0.0   VCNL4035                                                          06/20/2018 09:45:44 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE VCNL4035
OBJECT MODULE PLACED IN .\Obj\VCNL4035.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE VCNL4035.c LARGE BROWSE INCDIR(.\Application\Header) DEBUG OBJECTEXTEND 
                    -PRINT(.\Lis\VCNL4035.lst) TABS(2) OBJECT(.\Obj\VCNL4035.obj)

line level    source

   1          #include "VCNL4035X01.h"
   2          
   3          unsigned int Read_VCNL4035X(unsigned char command_code);
   4          void Write_VCNL4035X(unsigned char  command_code,unsigned char dat_h,unsigned char  dat_l);
   5          void Wait_ms_iic(int ms)
   6          {
   7   1        unsigned int De_Cnt;
   8   1        while( (ms--) != 0)
   9   1        {
  10   2          for(De_Cnt = 0; De_Cnt < 9; De_Cnt++); 
  11   2        }   
  12   1      }
  13          
  14          void Wait_ms_i2c(int ms)
  15          {
  16   1        unsigned int De_Cnt;
  17   1        while( (ms--) != 0)
  18   1        {
  19   2          for(De_Cnt = 0; De_Cnt < 1; De_Cnt++); 
  20   2        }   
  21   1      }
  22          void nop()
  23          {
  24   1        return;
  25   1      }
  26          void I2C_Start()
  27          {
  28   1      
  29   1        I2C_SCK=1;
  30   1        I2C_SDA=1;
  31   1        Wait_ms_iic(2);
  32   1        I2C_SDA=0;
  33   1        Wait_ms_i2c(2);
  34   1        I2C_SCK=0;
  35   1        //Wait_ms_i2c(1);
  36   1        //Wait_ms_iic(1);
  37   1      }
  38          
  39          void I2C_Stop()
  40          {
  41   1        I2C_SCK=0;
  42   1        I2C_SDA=0;
  43   1        Wait_ms_i2c(2);
  44   1        I2C_SCK=1;
  45   1        I2C_SDA=0;
  46   1        Wait_ms_i2c(4);
  47   1        I2C_SDA=1;
  48   1      
  49   1      }
  50          
  51          unsigned char I2C_ACK(void)
  52          {
  53   1        unsigned char i;
  54   1        unsigned char dat = 0;
C51 COMPILER V9.52.0.0   VCNL4035                                                          06/20/2018 09:45:44 PAGE 2   

  55   1      
  56   1        //I2C_SDA_Set();          //
  57   1        //for (i=0; i<1; i++)         //
  58   1        {
  59   2          dat <<= 1;                //
  60   2          I2C_SCK_Clr(); 
  61   2          Wait_ms_i2c(2);   //
  62   2          //nop();        
  63   2          if (I2C_SDA)        //If  PCF85063BTL_SDO is HIGH, dat will be 1(one) 
  64   2          {
  65   3            dat |= 0x01;            //
  66   3          }
  67   2          
  68   2      
  69   2          I2C_SCK_Set();       //
  70   2          Wait_ms_i2c(2);           //  
  71   2        }
  72   1        return dat;
  73   1      }
*** WARNING C280 IN LINE 53 OF VCNL4035.c: 'i': unreferenced local variable
  74          void uC_ACK()
  75          {
  76   1      
  77   1        unsigned char i;
  78   1        
  79   1        //for (i=0; i<1; i++)            //
  80   1        {
  81   2          I2C_SCK_Clr(); 
  82   2          //Wait_ms_i2c(1);//   
  83   2          //if( (dat&0x80)==0x80 )       //
  84   2          {
  85   3              I2C_SDA_Clr();
  86   3          }
  87   2      
  88   2          Wait_ms_i2c(2);           //
  89   2          I2C_SCK_Set();          //
  90   2                  //
  91   2          //dat <<= 1;                   //
  92   2          Wait_ms_i2c(2);      
  93   2        }
  94   1      
  95   1      
  96   1        
  97   1      }
*** WARNING C280 IN LINE 77 OF VCNL4035.c: 'i': unreferenced local variable
  98          
  99          void uC_NACK()
 100          {
 101   1      
 102   1        unsigned char i;
 103   1        
 104   1        //for (i=0; i<1; i++)            //
 105   1        {
 106   2          I2C_SCK_Clr(); 
 107   2          //Wait_ms_i2c(1);//   
 108   2          //if( (dat&0x80)==0x80 )       //
 109   2          {
 110   3              I2C_SDA_Set();
 111   3          }
 112   2      
 113   2          Wait_ms_i2c(2);           //
 114   2          I2C_SCK_Set();          //
C51 COMPILER V9.52.0.0   VCNL4035                                                          06/20/2018 09:45:44 PAGE 3   

 115   2                  //
 116   2          //dat <<= 1;                   //
 117   2          Wait_ms_i2c(2);      
 118   2        }
 119   1      
 120   1      
 121   1        
 122   1      }
*** WARNING C280 IN LINE 102 OF VCNL4035.c: 'i': unreferenced local variable
 123          
 124          void I2C_Init()
 125          {
 126   1          //P41 SDA,P42 SCL quasi-bidirectional
 127   1      
 128   1        P3M1 &=~( (1<<1) | (1<<2) );  //~ bitwise NOT
 129   1        P3M0 &=~( (1<<1) | (1<<2) );  
 130   1        //P4M1 |=0x04;// SCK OPen Drain output
 131   1        //P4M0 |=0x04;
 132   1        Write_VCNL4035X(PS_CONF1,0xFF,0x30);
 133   1        Write_VCNL4035X(PS_CONF3,0x00,0x07);
 134   1      }
 135          
 136          
 137          void I2C_SendByte(unsigned char dat)// Send dat to SPI device/Slave
 138          {
 139   1        unsigned char i;
 140   1        
 141   1        for (i=0; i<8; i++)            //
 142   1        {
 143   2          I2C_SCK_Clr(); 
 144   2          //Wait_ms_i2c(1);//   
 145   2          if( (dat&0x80)==0x80 )       //
 146   2          {
 147   3              I2C_SDA_Set();
 148   3          }
 149   2          else
 150   2          {
 151   3              I2C_SDA_Clr();
 152   3          }
 153   2          Wait_ms_i2c(2);           //
 154   2          I2C_SCK_Set();          //
 155   2                  //
 156   2          dat <<= 1;                   //
 157   2          Wait_ms_i2c(2);      
 158   2        }
 159   1      }
 160          
 161          
 162          
 163          unsigned char I2C_ReceiveByte(void)
 164          {
 165   1        unsigned char i;
 166   1        unsigned char dat = 0;
 167   1        
 168   1      
 169   1        //I2C_SDA_Set();          //
 170   1        for (i=0; i<8; i++)         //
 171   1        {
 172   2          dat <<= 1;                //
 173   2          I2C_SCK_Clr();       //
 174   2          Wait_ms_i2c(2);        //
 175   2              
C51 COMPILER V9.52.0.0   VCNL4035                                                          06/20/2018 09:45:44 PAGE 4   

 176   2          if (I2C_SDA)        //If  I2C_SDO is HIGH, dat will be 1(one) , I2C_SDO is defined in .h file
 177   2          {
 178   3            dat |= 0x01;            //
 179   3          }
 180   2          I2C_SCK_Set();       //
 181   2          Wait_ms_i2c(2);
 182   2          if (i==7)
 183   2          {
 184   3            I2C_SCK_Clr();
 185   3            //I2C_SDA_Clr();      
 186   3          }
 187   2          //  
 188   2        }
 189   1        return dat;
 190   1      }
 191          void Write_VCNL4035X(unsigned char  command_code,unsigned char dat_h,unsigned char  dat_l)
 192          {
 193   1        I2C_Start();
 194   1        Wait_ms_i2c(1);
 195   1        I2C_SendByte(VCNL4035_addr);
 196   1        if(I2C_ACK()==0)
 197   1        {
 198   2          I2C_SendByte(command_code);
 199   2        }
 200   1        if(I2C_ACK()==0)
 201   1          I2C_SendByte(dat_l);
 202   1      
 203   1        if(I2C_ACK()==0)
 204   1          I2C_SendByte(dat_h);
 205   1        
 206   1        if(I2C_ACK()==0)  
 207   1          I2C_Stop();
 208   1      }
 209          
 210          unsigned char Read_VCNL4035(unsigned char command_code)
 211          {
 212   1        unsigned int temp_dat=0,temp_dat_l=0,temp_dat_h=0;
 213   1        I2C_Start();
 214   1        Wait_ms_i2c(2);
 215   1        I2C_SendByte((VCNL4035_addr)|I2C_WRITE);
 216   1        if(I2C_ACK()==0)
 217   1        {
 218   2          I2C_SendByte(command_code);
 219   2        } 
 220   1        if(I2C_ACK()==0)
 221   1        {
 222   2          Wait_ms_iic(2);
 223   2          I2C_SCK=0;
 224   2          Wait_ms_iic(1);   
 225   2          I2C_Start();
 226   2          Wait_ms_i2c(2);
 227   2          I2C_SendByte((VCNL4035_addr)|I2C_READ);
 228   2        }   
 229   1        if(I2C_ACK()==0)
 230   1        {
 231   2          temp_dat_l|=I2C_ReceiveByte(); // data from proximity sensor
 232   2        }
 233   1        //Wait_ms_i2c(1); 
 234   1        
 235   1        uC_NACK();
 236   1        //Wait_ms_i2c(6);
 237   1        //P3M1 |=0x02;  //~ bitwise NOT
C51 COMPILER V9.52.0.0   VCNL4035                                                          06/20/2018 09:45:44 PAGE 5   

 238   1        //P3M0 &=~( (1<<1) | (1<<2) );  
 239   1        temp_dat_h|=I2C_ReceiveByte();
 240   1        //P3M1 &=~( (1<<1) | (1<<2) );  //~ bitwise NOT
 241   1        //P3M0 &=~( (1<<1) | (1<<2) ); 
 242   1        uC_NACK();
 243   1        //Wait_ms_i2c(2);
 244   1        I2C_Stop();
 245   1        Wait_ms_i2c(2);
 246   1        return temp_dat_l;
 247   1      }
 248          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    453    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      13
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
